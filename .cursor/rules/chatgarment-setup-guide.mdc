---
description:
globs:
alwaysApply: false
---
# ChatGarment/llava 환경 구축 및 실행 가이드

## 1. CUDA Toolkit 및 환경변수
- WSL2(우분투) 환경에서는 CUDA 드라이버만 설치되어 있을 수 있으므로, 반드시 CUDA Toolkit(예: 12.6)과 nvcc를 별도로 설치해야 함.
- 설치 후, 아래 환경변수를 반드시 설정:
  - `export CUDA_HOME=/usr/local/cuda-12.6` (설치 경로에 따라 다를 수 있음)
  - `export PATH=$CUDA_HOME/bin:$PATH`
  - `export LD_LIBRARY_PATH=$CUDA_HOME/lib64:$LD_LIBRARY_PATH`

## 2. 가상환경 및 필수 패키지
- `.venv` 가상환경을 활성화하고, PyTorch, torchvision, accelerate, einops, llava 등은 반드시 llava가 요구하는 버전(예: torch==2.1.2, torchvision==0.16.2, accelerate==0.32.0, einops==0.6.1)으로 설치해야 함.
- CUDA 버전에 맞는 PyTorch wheel을 설치해야 GPU가 정상 인식됨.

## 3. 모델 및 config 준비
- `checkpoints/<모델폴더>`에는 반드시 `pytorch_model.bin`과 `config.json`이 존재해야 하며, config.json에는 mm_hidden_size 등 vision 관련 설정이 포함되어야 함.

## 4. 실행 명령어 예시
```bash
python scripts/evaluate_garment_v2_imggen_1float.py \
  --model_name_or_path checkpoints/try_7b_lr1e_4_v3_garmentcontrol_4h100_v4_final \
  --data_path_eval ./data/eval_images \
  --vision_tower openai/clip-vit-large-patch14 \
  --cache_dir ./cache \
  --output_dir ./output \
  --bf16 True \
  --per_device_eval_batch_size 1 \
  --gradient_accumulation_steps 1 \
  --gradient_checkpointing True
```

## 5. 실행 전 체크리스트
- CUDA Toolkit(nvcc) 설치 및 환경변수 적용
- 가상환경 활성화 및 패키지 버전 일치
- 모델 폴더 내 config.json, pytorch_model.bin 존재
- GPU 인식 여부(`python -c "import torch; print(torch.cuda.is_available())"`)

## 6. 실행 후
- 정상 실행 시 output 폴더에 결과 생성
- 에러 발생 시 에러 메시지와 함께 추가 지원 요청 가능
